import com.fasterxml.jackson.databind.DeserializationFeature;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.beans.BeanUtils;

public Financement patchFinancementChamps(String idFinancement, Financement financementToUpdate) {
    Financement existingFinancement = financementRepository.findByidFinancement(idFinancement)
            .orElseThrow(() -> new FinancementNotFoundException("Le financement Ã  modifier est inexistant"));

    merge(existingFinancement, financementToUpdate);

    // Enregistrer les modifications
    return financementRepository.save(existingFinancement);
}

private void merge(Object target, Object source) {
    ObjectMapper objectMapper = new ObjectMapper();
    objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);

    // Convert source object to a map
    Map<String, Object> sourceMap = objectMapper.convertValue(source, Map.class);

    // Remove entries with null or empty values
    sourceMap.values().removeIf(Objects::isNull);

    // Merge source map into target object
    objectMapper.updateValue(target, sourceMap);
}
