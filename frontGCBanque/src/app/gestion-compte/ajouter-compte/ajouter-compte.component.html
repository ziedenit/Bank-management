import org.springframework.beans.BeanUtils;

public Financement patchFinancementChamps(String idFinancement, Financement financementToUpdate) {
    Financement existingFinancement = financementRepository.findByidFinancement(idFinancement).orElse(null);
    if (existingFinancement == null) {
        throw new FinancementNotFoundException(String.format("Le financement à modifier %s est inexistant", idFinancement));
    }

    // Copier les propriétés non nulles de financementToUpdate vers existingFinancement
    BeanUtils.copyProperties(financementToUpdate, existingFinancement, getNullPropertyNames(financementToUpdate));

    // Enregistrer les modifications
    return financementRepository.save(existingFinancement);
}

// Obtenir les noms des propriétés nulles dans un objet
private String[] getNullPropertyNames(Object source) {
    final BeanWrapper src = new BeanWrapperImpl(source);
    PropertyDescriptor[] pds = src.getPropertyDescriptors();

    Set<String> emptyNames = new HashSet<>();
    for (PropertyDescriptor pd : pds) {
        Object srcValue = src.getPropertyValue(pd.getName());
        if (srcValue == null) {
            emptyNames.add(pd.getName());
        }
    }
    String[] result = new String[emptyNames.size()];
    return emptyNames.toArray(result);
}
