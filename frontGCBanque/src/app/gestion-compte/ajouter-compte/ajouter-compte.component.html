import java.lang.reflect.Field;
import org.springframework.util.ReflectionUtils;

private void updateBien(Bien existingBien, Bien updatedBien) {
    updateObject(existingBien, updatedBien);
}

private void updateObject(Object existingObject, Object updatedObject) {
    Class<?> clazz = existingObject.getClass();
    Field[] fields = clazz.getDeclaredFields();

    for (Field field : fields) {
        try {
            ReflectionUtils.makeAccessible(field);
            if (isFieldPresent(updatedObject, field)) {
                Object updatedValue = field.get(updatedObject);

                if (updatedValue != null || (updatedValue instanceof String && "".equals(updatedValue))) {
                    // Update the field value, including setting it to an empty string if specified
                    field.set(existingObject, updatedValue);
                } else if (updatedValue == null && !field.getType().isPrimitive()) {
                    // If updated value is null and the field is not a primitive type, set it to null
                    field.set(existingObject, null);
                } else if (field.getType().isAssignableFrom(updatedObject.getClass())) {
                    // If updated value is an object, recursively update the nested object
                    Object existingNestedValue = field.get(existingObject);
                    Object updatedNestedValue = field.get(updatedObject);
                    if (existingNestedValue != null && updatedNestedValue != null) {
                        updateObject(existingNestedValue, updatedNestedValue);
                    } else if (existingNestedValue == null) {
                        field.set(existingObject, updatedNestedValue);
                    }
                }
            }
        } catch (IllegalAccessException e) {
            // Log the error
            commonLogger.eventTyp(EventTyp.APPLICATIVE).secEventTyp(SecEventTyp.METIER)
                        .logger().info("Erreur lors de l'update du financement dans le bien caus√© par: {}", e.getMessage());
        }
    }
}

// Helper method to check if the field is present in the updated object
private boolean isFieldPresent(Object updatedObject, Field field) {
    try {
        // Check if the field has been explicitly set in the updated object
        Field updatedField = updatedObject.getClass().getDeclaredField(field.getName());
        updatedField.setAccessible(true);
        return updatedField.get(updatedObject) != null || (updatedField.get(updatedObject) instanceof String && "".equals(updatedField.get(updatedObject)));
    } catch (NoSuchFieldException | IllegalAccessException e) {
        return false;
    }
}
